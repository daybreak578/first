<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>음식점 정보</title>
    <link rel="stylesheet" href="음식정보.css">
    <script type="text/javascript" src="jquery-3.7.1.min.js"></script>
</head>

<body>
    <script src="script.js"></script>
    <header id="header"></header>

    <div class="restaurant-container">
        <div id="restaurant-card"></div> 
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const contentid = urlParams.get('contentid');  // 쿼리 스트링에서 contentid 가져옴

            if (contentid) {
                fetchRestaurantInfo(contentid);  // contentid가 있을 경우 음식점 정보 가져오기
            } else {
                console.log("contentid가 없음");
            }

            // 음식점 정보 가져오기
            function fetchRestaurantInfo(contentid) {
                const serviceKey = "5EPM0JZGu2vix+JS73ESvNyiqPOiAlZvqw7HOMHMsVok5OAlScfevj/AcerZwoWPXx/B6AkWxHZhcfUp0j/aVA=="; // 인증키
                const apiUrl = "http://apis.data.go.kr/B551011/KorService1/detailIntro1"; // 음식점 정보 API

                $.ajax({
                    url: apiUrl,
                    type: 'GET',
                    data: {
                        serviceKey: serviceKey,
                        MobileApp: "AppTest",
                        MobileOS: "ETC",
                        contentId: contentid,
                        contentTypeId: "39",  // 음식점 정보는 contentTypeId 39
                        _type: "json"
                    },
                    success: function (response) {
                        console.log(response);

                        if (response.response.header.resultCode === "0000" && response.response.body.items) {
                            let items = response.response.body.items.item;

                            // item이 배열이 아니면 객체일 수 있으므로, 배열처럼 처리
                            if (!Array.isArray(items)) {
                                items = [items];  
                            }

                            // items 배열이 존재하고, 길이가 0 이상인 경우 처리
                            if (items.length > 0) {
                                const restaurantList = items.map(restaurant => {
                                    return `
                                        <div class="restaurant-card">
                                            <h3>${restaurant.title || '음식점 이름 없음'}</h3>
                                            <p>주소: ${restaurant.addr || '정보 없음'}</p>
                                            <p>전화번호: ${restaurant.tel || '정보 없음'}</p>
                                            <p>신용카드 가능 여부: ${restaurant.chkcreditcardfood || '정보 없음'}</p>
                                            <p>할인 정보: ${restaurant.discountinfofood || '정보 없음'}</p>
                                            <p>대표 메뉴: ${restaurant.firstmenu || '정보 없음'}</p>
                                            <p>문의 및 안내: ${restaurant.infocenterfood || '정보 없음'}</p>
                                            <p>어린이 놀이방 여부: ${restaurant.kidsfacility || '정보 없음'}</p>
                                            <p>개업일: ${restaurant.opendatefood || '정보 없음'}</p>
                                            <p>영업시간: ${restaurant.opentimefood || '정보 없음'}</p>
                                            <p>포장 가능 여부: ${restaurant.packing || '정보 없음'}</p>
                                            <p>주차시설: ${restaurant.parkingfood || '정보 없음'}</p>
                                            <p>예약 안내: ${restaurant.reservationfood || '정보 없음'}</p>
                                            <p>쉬는 날: ${restaurant.restdatefood || '정보 없음'}</p>
                                            <p>규모: ${restaurant.scalefood || '정보 없음'}</p>
                                            <p>좌석 수: ${restaurant.seat || '정보 없음'}</p>
                                            <p>금연/흡연 여부: ${restaurant.smoking || '정보 없음'}</p>
                                            <p>취급 메뉴: ${restaurant.treatmenu || '정보 없음'}</p>
                                            <p>인허가 번호: ${restaurant.lcnsno || '정보 없음'}</p>
                                        </div>
                                    `;
                                }).join('');

                                console.log(restaurantList);
                                $('#restaurant-card').html(restaurantList);
                            }
                        } else {
                            $('#restaurant-card').html("<h1>해당 콘텐츠에 대한 음식점 정보가 없습니다.</h1>");
                        }
                    },
                    error: function () {
                        $('#restaurant-card').html("<p>음식점 정보 요청에 실패했습니다. 서버나 인터넷 연결을 확인하세요.</p>");
                    }
                });
            }
        });
    </script>

</body>

</html>
